<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BookFromHub</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #f0f0f0;
    }

    .card {
      background: rgba(255, 255, 255, 0.07);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      padding: 48px 40px;
      width: 100%;
      max-width: 540px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 28px;
    }

    .logo svg { width: 40px; height: 40px; fill: #a78bfa; }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, #a78bfa, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    p.subtitle {
      font-size: 0.9rem;
      color: #94a3b8;
      margin-bottom: 32px;
    }

    label {
      display: block;
      font-size: 0.85rem;
      color: #cbd5e1;
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input[type="url"] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: #f0f0f0;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      margin-bottom: 24px;
    }

    input[type="url"]::placeholder { color: #64748b; }

    input[type="url"]:focus {
      border-color: #a78bfa;
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2);
    }

    button {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, #7c3aed, #3b82f6);
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      letter-spacing: 0.03em;
    }

    button:hover:not(:disabled) { opacity: 0.9; transform: translateY(-1px); }
    button:active:not(:disabled) { transform: translateY(0); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    #status {
      margin-top: 20px;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 0.9rem;
      display: none;
    }

    #status.info {
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #93c5fd;
      display: block;
    }

    #status.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      display: block;
    }

    #status.success {
      background: rgba(34, 197, 94, 0.15);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #86efac;
      display: block;
    }

    .spinner {
      display: inline-block;
      width: 14px; height: 14px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      vertical-align: middle;
      margin-right: 6px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57
          0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695
          -.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99
          .105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225
          -.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405
          c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225
          0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3
          0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
      </svg>
      <h1>BookFromHub</h1>
    </div>
    <p class="subtitle">Turn any public GitHub repository's markdown files into a PDF book.</p>

    <label for="repoUrl">GitHub Repository URL</label>
    <input
      type="url"
      id="repoUrl"
      placeholder="https://github.com/user/repo"
      autocomplete="off"
      spellcheck="false"
    />

    <button id="generateBtn" onclick="generate()">ðŸ“„ Generate PDF</button>

    <div id="status"></div>
  </div>

  <script>
    async function generate() {
      const repoUrl = document.getElementById('repoUrl').value.trim();
      const btn = document.getElementById('generateBtn');
      const status = document.getElementById('status');

      if (!repoUrl) {
        showStatus('Please enter a GitHub repository URL.', 'error');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Generating PDFâ€¦';
      showStatus('Fetching repository contents and building PDFâ€¦', 'info');

      try {
        const response = await fetch('/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ repoUrl })
        });

        if (!response.ok) {
          const text = await response.text();
          let msg = 'An error occurred.';
          try {
            const json = JSON.parse(text);
            msg = json.detail || json.title || text;
          } catch { msg = text; }
          showStatus('Error: ' + msg, 'error');
          return;
        }

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const repoName = repoUrl.split('/').filter(Boolean).pop() || 'book';
        a.href = url;
        a.download = repoName + '-book.pdf';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        showStatus('âœ… PDF generated and downloaded successfully!', 'success');
      } catch (err) {
        showStatus('Network error: ' + err.message, 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'ðŸ“„ Generate PDF';
      }
    }

    function showStatus(msg, type) {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.className = type;
    }

    document.getElementById('repoUrl').addEventListener('keydown', e => {
      if (e.key === 'Enter') generate();
    });
  </script>
</body>
</html>
